<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>吳興街友 攻守名單管理系統</title>
  <style>
    body { font-family: sans-serif; background: #fff; margin: 0; padding: 1rem; }
    .wrapper { max-width: 960px; margin: auto; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
    th, td { border: 1px solid #ccc; text-align: center; padding: 6px; }
    .title { text-align: center; font-size: 1.2rem; font-weight: bold; margin: 1rem 0; }
    .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; }
    .player { background: #e0f7fa; border: 1px solid #00796b; padding: 4px; border-radius: 4px; text-align: center; cursor: grab; }
    .sub-row { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    input, select { width: 100%; padding: 4px; }
    .score input { font-size: 3rem; font-family: 'Arial Black', Arial, sans-serif; text-align: center; }
    .score { display: flex; justify-content: center; gap: 1rem; padding: 1rem; border-radius: 8px; }
    .score.green { background-color: #d0f5d0; }
    .score.red { background-color: #f8d0d0; }
    .score.orange { background-color: #ffe5b4; }
    .droppable td { min-height: 38px; }
  </style>
</head>
<body>
<div class="wrapper">
  <div class="title" id="title">吳興街友 攻守名單</div>
  <table>
    <tr><td colspan="2">比賽日期</td><td colspan="2" id="date"></td><td>開賽時間</td><td id="start"></td></tr>
    <tr><td colspan="2">比賽對手</td><td colspan="2" id="opponent"></td><td>集合時間</td><td id="gather"></td></tr>
    <tr><td colspan="6" id="offdef">攻守：</td></tr>
  </table>
  <table>
    <thead><tr><th>打序</th><th>守位</th><th>姓名</th><th>背號</th></tr></thead>
    <tbody id="lineup" class="droppable"></tbody>
    <tr id="pitcher-row">
      <td colspan="2">P</td>
      <td id="pitcher-name"></td>
      <td id="pitcher-num"></td>
    </tr>
  </table>
  <div class="title">預備球員</div>
  <div id="bench" class="grid"></div>
  <div class="title">球員更換</div>
  <div class="sub-row">
    <div><label>換下</label><select id="sub-out"></select></div>
    <div><label>換上</label><select id="sub-in"></select></div>
    <div style="align-self: end;"><button onclick="substitute()">執行換人</button></div>
  </div>
  <div class="title">守位輪換</div>
  <input type="text" id="rotate-input" />
  <button onclick="rotatePositions()" style="margin-top:0.5rem;width:100%">執行輪換</button>
  <div class="title">比數</div>
  <div class="score" id="score-area">
    <input type="number" id="score1" value="0" onchange="updateScoreColor()" />:<input type="number" id="score2" value="0" onchange="updateScoreColor()" />
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const sheetCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTeA--X7L0ZCeQvqXvxZjLatdC_yCCJy2QHStokg6pRbBqRC6mBNWf3f03O5U3UHBgxFaIl47K39m8R/pub?output=csv';
let players = [], lineup = new Array(9).fill(null), positions = new Array(9).fill('1'), pitcher = null;

function updateScoreColor() {
  const s1 = parseInt(document.getElementById('score1').value) || 0;
  const s2 = parseInt(document.getElementById('score2').value) || 0;
  const area = document.getElementById('score-area');
  area.classList.remove('green', 'red', 'orange');
  if (s1 > s2) area.classList.add('green');
  else if (s1 < s2) area.classList.add('red');
  else area.classList.add('orange');
}

// ...（保留原始 fetch 與其他函式內容不變）...

function updateSubDropdowns() {
  const outSel = document.getElementById('sub-out');
  const inSel = document.getElementById('sub-in');
  outSel.innerHTML = '';
  inSel.innerHTML = '';
  lineup.forEach((p, i) => {
    if (p) {
      const opt = document.createElement('option');
      opt.value = i;
      opt.text = `#${p['背號']} ${p['姓名']}`;
      outSel.appendChild(opt);
    }
  });
  if (pitcher) {
    const opt = document.createElement('option');
    opt.value = 'pitcher';
    opt.text = `#${pitcher['背號']} ${pitcher['姓名']} (P)`;
    outSel.appendChild(opt);
  }
  players.forEach((p, i) => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.text = `#${p['背號']} ${p['姓名']}`;
    inSel.appendChild(opt);
  });
}

function substitute() {
  const outSel = document.getElementById('sub-out').value;
  const inIdx = parseInt(document.getElementById('sub-in').value);
  if (isNaN(inIdx)) return;
  const incoming = players[inIdx];
  if (outSel === 'pitcher') {
    pitcher = incoming;
  } else {
    const outIdx = parseInt(outSel);
    if (!isNaN(outIdx)) lineup[outIdx] = incoming;
  }
  players.splice(inIdx, 1);
  renderLineup();
  renderBench();
  renderPitcher();
  updateScoreColor();
}
</script>
</body>
</html>
